// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id_usuario     Int      @id @default(autoincrement())
  usuario        String   @unique
  email          String   @unique
  pass           String
  idioma         String
  fecha_registro DateTime @default(now())
  id_familia     Int?
  familia        Family?  @relation(fields: [id_familia], references: [id_familia])

  perfil      PlayerProfile?
  recursos    PlayerResources?
  propiedades Propiedad[]
}

model Family {
  id_familia  Int      @id @default(autoincrement())
  nombre      String   @unique
  tag         String   @unique
  emblema_url String?
  miembros    User[]
}

model PlayerProfile {
  id_perfil            Int  @id @default(autoincrement())
  id_usuario           Int  @unique
  usuario              User @relation(fields: [id_usuario], references: [id_usuario])
  puntos_edificios     Int
  puntos_tropas        Int
  puntos_entrenamiento Int
  ranking_global       Int
  lealtad              Int
}

model PlayerResources {
  id_recursos          Int      @id @default(autoincrement())
  id_usuario           Int      @unique
  usuario              User     @relation(fields: [id_usuario], references: [id_usuario])
  armas                BigInt
  municion             BigInt
  alcohol              BigInt
  dolares              BigInt
  ultima_actualizacion DateTime @updatedAt
}

model Propiedad {
  id_propiedad Int    @id @default(autoincrement())
  id_usuario   Int
  usuario      User   @relation(fields: [id_usuario], references: [id_usuario])
  nombre       String
  coord_x      Int
  coord_y      Int
  coord_z      Int
  edificios    PropiedadEdificio[]

  @@unique([coord_x, coord_y, coord_z])
}

model Building {
  id_edificio  Int                 @id
  nombre       String
  descripcion  String
  costo_base   Json
  factor_costo Float
  propiedades  PropiedadEdificio[]
}

model PropiedadEdificio {
  id           Int       @id @default(autoincrement())
  id_propiedad Int
  id_edificio  Int
  nivel        Int
  propiedad    Propiedad @relation(fields: [id_propiedad], references: [id_propiedad])
  edificio     Building  @relation(fields: [id_edificio], references: [id_edificio])

  @@unique([id_propiedad, id_edificio])
}
